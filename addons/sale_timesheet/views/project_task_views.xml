<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="project_project_view_form" model="ir.ui.view">
        <field name="name">project.project.form.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="hr_timesheet.project_invoice_form"/>
        <field name="arch" type="xml">
<<<<<<< HEAD
=======
            <div class="oe_button_box" position="inside">
                <button string="Project Overview" class="oe_stat_button" type="object" name="action_view_timesheet" icon="fa-puzzle-piece" attrs="{'invisible': [('allow_billable', '=', False)]}"/>
            </div>
            <xpath expr="//button[@name='action_view_so']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', '|', ('allow_billable', '=', False), ('sale_order_id', '=', False), ('bill_type', '!=', 'customer_project')]}</attribute>
              </xpath>
            <xpath expr="//header" position="inside">
                <button name="action_make_billable" string="Create Sales Order" type="object" attrs="{'invisible': [('display_create_order', '=', False)]}" groups="sales_team.group_sale_salesman"/>
            </xpath>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
            <xpath expr="//page[@name='settings']" position="after">
                <page name="billing_employee_rate" string="Invoicing" attrs="{'invisible': ['|', ('allow_billable', '=', False), ('partner_id', '=', False)]}">
                    <group>
                        <group>
                            <field name="display_create_order" invisible="1"/>
<<<<<<< HEAD
                            <field name="pricing_type" invisible="1" widget="radio"/>
                            <field name="timesheet_product_id" string="Default Service" invisible="1" context="{'default_detailed_type': 'service', 'default_service_policy': 'delivered_timesheet', 'default_service_type': 'timesheet'}"/>
                            <field name="sale_order_id" invisible="1" options="{'no_create': True, 'no_edit': True, 'delete': False, 'no_open': True}"/>
                            <field name="sale_line_id" groups="!sales_team.group_sale_salesman" options="{'no_create': True, 'no_edit': True, 'delete': False, 'no_open': True}"/>
                            <field name="sale_line_id" groups="sales_team.group_sale_salesman" options="{'no_create': True, 'no_edit': True, 'delete': False}"/>
=======
                            <field name="bill_type" widget="radio"/>
                            <field name="pricing_type" attrs="{'invisible': ['|', ('allow_billable', '=', False), ('bill_type', '!=', 'customer_project')], 'required': ['&amp;', ('allow_billable', '=', True), ('allow_timesheets', '=', True)]}" widget="radio"/>
                            <field name="timesheet_product_id" string="Service" attrs="{'invisible': ['|', '|', ('allow_timesheets', '=', False), ('sale_order_id', '!=', False), ('bill_type', '!=', 'customer_task')], 'required': ['&amp;', ('allow_billable', '=', True), ('allow_timesheets', '=', True)]}" context="{'default_type': 'service', 'default_service_policy': 'delivered_timesheet', 'default_service_type': 'timesheet'}"/>
                            <field name="sale_order_id" attrs="{'invisible': [('bill_type', '!=', 'customer_project')], 'readonly': [('sale_order_id', '!=', False)]}" force_save="1" options="{'no_create': True, 'no_edit': True, 'delete': False, 'no_open': True}"/>
                            <field name="sale_line_id" string="Default Sales Order Item" attrs="{'invisible': [('bill_type', '!=', 'customer_project')]}" options="{'no_create': True, 'no_edit': True, 'delete': False, 'no_open': True}"/>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
                        </group>
                    </group>
                    <field name="sale_line_employee_ids">
                        <tree editable="bottom">
                            <field name="company_id" invisible="1"/>
                            <field name="partner_id" invisible="1"/>
                            <field name="employee_id" options="{'no_create': True}"/>
<<<<<<< HEAD
                            <field name="sale_line_id" attrs="{'required': True}" options="{'no_create': True}"/>
                            <field name="price_unit" widget="monetary" force_save="1" options="{'currency_field': 'currency_id'}"/>
                            <field name="display_cost" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="is_cost_changed" invisible="1"/>
=======
                            <field name="timesheet_product_id" attrs="{'column_invisible': [('parent.sale_order_id', '!=', False)]}" invisible="1"/>
                            <field name="sale_line_id" attrs="{'required': True}" options="{'no_create': True}" domain="[('order_id','=',parent.sale_order_id), ('is_service', '=', True)]"/>
                            <field name="price_unit" widget="monetary" force_save="1" options="{'currency_field': 'currency_id'}"/>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
                            <field name="currency_id" invisible="1"/>
                            <field name="cost_currency_id" invisible="1"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="project_project_view_form_salesman" model="ir.ui.view">
        <field name="name">project.project.form.inherit.salesman</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="sale_timesheet.project_project_view_form"/>
        <field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]"/>
        <field name="arch" type="xml">
            <field name="sale_order_id" position="attributes">
                <attribute name="options">{'no_create': True, 'no_edit': True, 'delete': False}</attribute>
            </field>
            <field name="sale_line_id" position="attributes">
                <attribute name="options">{'no_create': True, 'no_edit': True, 'delete': False}</attribute>
            </field>
        </field>
    </record>

    <record id="project_project_view_form_simplified_inherit" model="ir.ui.view">
        <field name="name">project.project.view.form.simplified.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="hr_timesheet.project_project_view_form_simplified_inherit_timesheet"/>
        <field name="arch" type="xml">
<<<<<<< HEAD
            <xpath expr="//div[hasclass('o_setting_box')]" position="before">
                <div class="col-lg-6 o_setting_box">
                    <div class="o_setting_left_pane">
                        <field name="company_id" invisible="1"/>
                        <field name="allow_billable"/>
                    </div>
                    <div class="o_setting_right_pane">
                        <label for="allow_billable"/>
                        <div class="text-muted" id="allow_billable_setting">
                            Invoice your time and material to customers
                        </div>
                    </div>
                </div>
            </xpath>
=======
            <field name="allow_timesheets" position="after">
                <field name="company_id" invisible="1"/>
                <field name="allow_billable"/>
            </field>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
        </field>
    </record>

    <record id="project_project_view_kanban_inherit_sale_timesheet" model="ir.ui.view">
        <field name="name">project.project.kanban.inherit.sale.timesheet</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="hr_timesheet.view_project_kanban_inherited"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='allow_timesheets']" position="after">
                <field name="allow_billable"/>
                <field name="warning_employee_rate" invisible="1"/>
<<<<<<< HEAD
                <field name="sale_order_id" invisible="1"/>
                <field name="pricing_type" invisible="1"/>
            </xpath>
            <xpath expr="//div[hasclass('o_kanban_manage_reporting')]" position="inside">
                <div role="menuitem" t-if="record.rating_active.raw_value" groups="project.group_project_manager">
                   <a name="action_view_all_rating" type="object">
                    Customer Ratings
                    </a>
                </div> 
=======
            </xpath>
            <xpath expr="//div[hasclass('o_primary')]//span" position="inside">
                <t t-if="1 == 0">
                   <i class="ml-2 fa fa-exclamation-triangle text-danger small" role="img" title="Some of the employees who are recording time on this project are not linked to any Sales Order Item. This means that their time will be considered as non-billable." aria-label="Some of the employees who are recording time on this project are not linked to any ales Order Item. This means that their time will be considered as non-billable."/>
                </t>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
            </xpath>
        </field>
    </record>

    <!-- We do a separate inheritance from the base view for the SO button to give the buttons a deterministic order using priorities -->
    <record id="project_project_view_kanban_inherit_sale_timesheet_so_button" model="ir.ui.view">
        <field name="name">project.project.kanban.inherit.sale.timesheet.so.button</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="priority">30</field>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_kanban_manage_view')]" position="inside">
                <div t-if="record.allow_billable.raw_value and record.sale_order_id.raw_value and record.pricing_type.raw_value != 'task_rate'"
                    role="menuitem"
                    groups="sales_team.group_sale_salesman_all_leads">
                    <a name="action_view_sos" type="object">Sales Orders</a>
                </div>
            </xpath>
        </field>
    </record>

        <record id="view_sale_service_inherit_form2" model="ir.ui.view">
            <field name="name">sale.service.form.view.inherit</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="hr_timesheet.view_task_form2_inherited"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="inside">
                    <field name="allow_billable" invisible="1"/>
<<<<<<< HEAD
=======
                    <field name="display_create_order" invisible="1"/>
                    <button name="action_make_billable" string="Create Sales Order" type="object" attrs="{'invisible': [('display_create_order', '=', False)]}" groups="sales_team.group_sale_salesman" invisible="1"/>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
                </xpath>
                <xpath expr="//field[@name='child_ids']/tree//field[@name='remaining_hours']" position="after">
                    <field name="remaining_hours_so" widget="timesheet_uom" optional="hide" groups="base.group_user"/>
                </xpath>
                <xpath expr="//field[@name='depend_on_ids']/tree//field[@name='remaining_hours']" position="after">
                    <field name="remaining_hours_so" widget="timesheet_uom" optional="hide" groups="base.group_user"/>
                </xpath>

            </field>
        </record>

        <record id="view_task_tree2_inherited" model="ir.ui.view">
            <field name="name">project.task.tree.inherited</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="hr_timesheet.view_task_tree2_inherited" />
            <field name="arch" type="xml">
                <xpath expr="//field[@name='remaining_hours']" position="after">
                    <field name="remaining_hours_so" widget="timesheet_uom" optional="hide"/>
                </xpath>
            </field>
        </record>

        <record id="project_task_view_form_inherit_sale_timesheet" model="ir.ui.view">
            <field name="name">project.task.form.inherit.timesheet</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
<<<<<<< HEAD
=======
            <field name="groups_id" eval="[(6,0, (ref('hr_timesheet.group_hr_timesheet_user'),))]"/>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
            <field name="arch" type="xml">
                <xpath expr="//field[@name='timesheet_ids']/tree" position="attributes">
                    <!-- <field name="timesheet_ids"/> is already inside a block groups="hr_timesheet.group_hr_timesheet_user"  -->
                    <attribute name="decoration-muted">timesheet_invoice_id != False</attribute>
                </xpath>
                <xpath expr="//field[@name='user_ids']" position="after">
                    <field name="is_project_map_empty" invisible="1" groups="hr_timesheet.group_hr_timesheet_user"/>
                    <field name="has_multi_sol" invisible="1" groups="hr_timesheet.group_hr_timesheet_user"/>
                </xpath>
                 <xpath expr="//field[@name='partner_phone']" position="after">
<<<<<<< HEAD
                    <field name="pricing_type" invisible="1" groups="hr_timesheet.group_hr_timesheet_user"/>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']" position="attributes">
                    <!-- <field name="timesheet_ids"/> is already inside a block groups="hr_timesheet.group_hr_timesheet_user"  -->
                    <attribute name="widget">so_line_one2many</attribute>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/tree" position="inside">
                    <!-- <field name="timesheet_ids"/> is already inside a block groups="hr_timesheet.group_hr_timesheet_user"  -->
                    <field name="is_so_line_edited" invisible="1" />
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/tree/field[@name='unit_amount']" position="before">
                    <!-- <field name="timesheet_ids"/> is already inside a block groups="hr_timesheet.group_hr_timesheet_user"  -->
                    <field name="timesheet_invoice_id" invisible="1"/>
                    <field name="so_line" widget="so_line_field" groups="!sales_team.group_sale_salesman"
                        attrs="{'column_invisible': [('parent.allow_billable', '=', False)]}"
                        context="{'with_remaining_hours': True, 'with_price_unit': True}" options="{'no_create': True, 'no_open': True}"
                        domain="[('is_service', '=', True), ('order_partner_id', 'child_of', parent.commercial_partner_id), ('is_expense', '=', False), ('state', 'in', ['sale', 'done'])]"
                        optional="hide"/>
                    <field name="so_line" widget="so_line_field" groups="sales_team.group_sale_salesman"
                        attrs="{'column_invisible': [('parent.allow_billable', '=', False)]}"
                        context="{'with_remaining_hours': True, 'with_price_unit': True}" options="{'no_create': True}"
                        domain="[('is_service', '=', True), ('order_partner_id', 'child_of', parent.commercial_partner_id), ('is_expense', '=', False), ('state', 'in', ['sale', 'done'])]"
                        optional="hide"/>
                </xpath>
                <xpath expr="//field[@name='remaining_hours']" position="after">
                    <t groups="hr_timesheet.group_hr_timesheet_user">
                        <field name="sale_order_id" invisible="1"/>
                        <field name="remaining_hours_available" invisible="1"/>
                        <span id="remaining_hours_so_label" attrs="{'invisible': ['|', '|', '|', '|', ('allow_billable', '=', False), ('sale_order_id', '=', False), ('partner_id', '=', False), ('sale_line_id', '=', False), ('remaining_hours_available', '=', False)]}" class="o_td_label float-start">
                            <label class="fw-bold" for="remaining_hours_so" string="Remaining Hours on SO"
                                attrs="{'invisible': ['|', ('encode_uom_in_days', '=', True), ('remaining_hours_so', '&lt;', 0)]}"/>
                            <label class="fw-bold" for="remaining_hours_so" string="Remaining Days on SO"
                                attrs="{'invisible': ['|', ('encode_uom_in_days', '=', False), ('remaining_hours_so', '&lt;', 0)]}"/>
                            <label class="fw-bold text-danger" for="remaining_hours_so" string="Remaining Hours on SO"
                                attrs="{'invisible': ['|', ('encode_uom_in_days', '=', True), ('remaining_hours_so', '&gt;=', 0)]}"/>
                            <label class="fw-bold text-danger" for="remaining_hours_so" string="Remaining Days on SO"
                                attrs="{'invisible': ['|', ('encode_uom_in_days', '=', False), ('remaining_hours_so', '&gt;=', 0)]}"/>
                        </span>
                        <field name="remaining_hours_so" nolabel="1" widget="timesheet_uom" attrs="{'invisible': ['|', '|', '|', '|', ('allow_billable', '=', False), ('sale_order_id', '=', False), ('partner_id', '=', False), ('sale_line_id', '=', False), ('remaining_hours_available', '=', False)]}" decoration-danger="remaining_hours_so &lt; 0"></field>
                    </t>
=======
                    <field name="bill_type" invisible="1"/>
                    <field name="pricing_type" invisible="1"/>
                    <field name="timesheet_product_id" invisible="1"/>
                    <field name="non_allow_billable" attrs="{'invisible': ['|', '|', '|', ('allow_billable', '=', False), ('allow_timesheets', '=', False), ('pricing_type', '!=', 'employee_rate'), ('bill_type', '=', 'customer_task')]}" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/tree/field[@name='unit_amount']" position="before">
                    <field name="timesheet_invoice_id" invisible="1"/>
                    <field name="so_line" readonly="1" attrs="{'column_invisible': [('parent.allow_billable', '=', False)]}" context="{'with_remaining_hours': True}" optional="hide"/>
                </xpath>
                <xpath expr="//field[@name='timesheet_ids']/tree" position="inside">
                    <field name="non_allow_billable" invisible="1"/>
                </xpath>
                <xpath expr="//field[@name='remaining_hours']" position="after">
                    <field name="remaining_hours_available" invisible="1"/>
                    <span id="remaining_hours_so_label" attrs="{'invisible': ['|', '|', '|', '|', ('allow_billable', '=', False), ('sale_order_id', '=', False), ('partner_id', '=', False), ('sale_line_id', '=', False), ('remaining_hours_available', '=', False)]}">
                        <label class="font-weight-bold" for="remaining_hours_so" string="Remaining Hours on SO"
                               attrs="{'invisible': ['|', ('encode_uom_in_days', '=', True), ('remaining_hours_so', '&lt;', 0)]}"/>
                        <label class="font-weight-bold" for="remaining_hours_so" string="Remaining Days on SO"
                               attrs="{'invisible': ['|', ('encode_uom_in_days', '=', False), ('remaining_hours_so', '&lt;', 0)]}"/>
                        <label class="font-weight-bold text-danger" for="remaining_hours_so" string="Remaining Hours on SO"
                               attrs="{'invisible': ['|', ('encode_uom_in_days', '=', True), ('remaining_hours_so', '&gt;=', 0)]}"/>
                        <label class="font-weight-bold text-danger" for="remaining_hours_so" string="Remaining Days on SO"
                               attrs="{'invisible': ['|', ('encode_uom_in_days', '=', False), ('remaining_hours_so', '&gt;=', 0)]}"/>
                    </span>
                    <field name="remaining_hours_so" nolabel="1" widget="timesheet_uom" attrs="{'invisible': ['|', '|', '|', '|', ('allow_billable', '=', False), ('sale_order_id', '=', False), ('partner_id', '=', False), ('sale_line_id', '=', False), ('remaining_hours_available', '=', False)]}"></field>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
                </xpath>
            </field>
        </record>

        <record id="view_task_form2_inherit_sale_timesheet" model="ir.ui.view">
            <field name="name">view.task.form2.inherit</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
<<<<<<< HEAD
                <xpath expr="//field[@name='sale_line_id'][2]" position="attributes">
                    <attribute name="context">{'create': False, 'edit': False, 'delete': False, 'with_price_unit': True, 'with_remaining_hours': True}</attribute>
                    <!-- To do: move allow_billable field in sale_project and add attrs directly on field in master -->
                    <attribute name="attrs">
                        {'invisible': [('allow_billable', '=', False)]}
                    </attribute>
=======
                <xpath expr="//field[@name='sale_line_id']" position="attributes">
                    <attribute name="context">{'with_remaining_hours': True}</attribute>
                    <attribute name="attrs">
                        {'invisible': ['|', ('allow_billable', '=', False), ('partner_id', '=', False)]}
                    </attribute>
                </xpath>
                <xpath expr="//field[@name='sale_order_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
>>>>>>> 57f59f2088c46f4603ff83bbcf2db42d705331fe
                </xpath>
            </field>
        </record>
</odoo>
